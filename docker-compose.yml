# ===========================================
# MentoArk - Serviço de site para Traefik
# ===========================================

version: "3.8"

services:
  mentoark-site:
    build:
      context: .
      args:
        - VITE_SUPABASE_URL=${VITE_SUPABASE_URL}
        - VITE_SUPABASE_PUBLISHABLE_KEY=${VITE_SUPABASE_PUBLISHABLE_KEY}
        - VITE_API_URL=${VITE_API_URL:-https://dev-erp.aesirerp.com}
        - VITE_WHATSAPP_NUMBER=${VITE_WHATSAPP_NUMBER:-+55 11 99999-9999}
        - VITE_APP_ENV=${VITE_APP_ENV:-production}
    container_name: mentoark-site
    restart: always
    # Sem ports diretos – o Traefik faz o proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mentoark.rule=Host(`${DOMAIN}`) || Host(`${DOMAIN_WWW}`)"
      - "traefik.http.routers.mentoark.entrypoints=websecure"
      - "traefik.http.routers.mentoark.tls.certresolver=letsencrypt"
      - "traefik.http.services.mentoark.loadbalancer.server.port=80"
      - "traefik.http.middlewares.mentoark-redirect-https.redirectscheme.scheme=https"
      - "traefik.http.routers.mentoark-http.rule=Host(`${DOMAIN}`) || Host(`${DOMAIN_WWW}`)"
      - "traefik.http.routers.mentoark-http.entrypoints=web"
      - "traefik.http.routers.mentoark-http.middlewares=mentoark-redirect-https"
    networks:
      - mentoark
    env_file:
      - .env

networks:
  mentoark:
    external: true
